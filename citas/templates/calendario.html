{% extends "home/base.html" %}
{% load i18n static %}

{% block title %}Reserva{% endblock %}

{% block extrahead %}
{% endblock %}

{% block content %}
<div class="container">
    <div class="login-container">
        <h2>Seleccionar Fecha y Hora</h2>
        <div id="calendar"></div>
        <div id="time-slots"></div>
        <div id="invitado"></div>
        <section class="form-confirmation">
            {% if user.is_authenticated %}
            <button class="btn btn-primary" id="crearCita">Continuar</button>
            {% else %}
            <button class="btn btn-primary" id="crearCitaInvitado">Continuar</button>
            {% endif %}
        </section>
    </div>
</div>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.min.js"></script>
<script>
    // JavaScript for handling steps and interactions
    $(function() {
        const selectedDate = null;
        // Initialize date picker for Step 2
        $('#calendar').datepicker({
            onSelect: function(dateText) {
                //const selectedDate = new Date(dateText);
                // Populate available time slots for the selected date
                // ... Your logic here to populate time slots
                populateTimeSlots(null);
            }
        });
        const selectedTimeSlot = null;
        function populateTimeSlots(selectedDate) {
            // Dummy implementation for available time slots (replace with your logic)
            
            const availableTimeSlots = [
                '09:00 AM', '10:00 AM', '11:00 AM', '02:00 PM', '03:00 PM', '04:00 PM'
            ];

            const timeSlotsContainer = $('#time-slots');
            timeSlotsContainer.empty();

            const slotsGroup = $('<div class="btn-group" role="group" aria-label="Basic radio toggle button group">');

            availableTimeSlots.forEach((slot, index) => {
                const radioId = `btnradio${index + 1}`;
                const radioInput = $(`<input type="radio" class="btn-check" name="btnradio" id="${radioId}" autocomplete="off">`);
                const radioLabel = $(`<label class="btn btn-outline-primary" for="${radioId}">${slot}</label>`);

                // Add event listener to radio button
                radioInput.on('click', function() {
                    //selectedTimeSlot = slot; // Assign the selected time slot
                });

                slotsGroup.append(radioInput);
                slotsGroup.append(radioLabel);
            });

            timeSlotsContainer.append(slotsGroup);  
        }
        $('#crearCita').click(function() {
            // Get the data to be sent
            const userId = "{{ user.id }}"; 
            const servicio = "Corte de pelo"; 
            const especialista = "Mar√≠a Bollicao"; 
            let selectedDate = "2023-12-01";
            let selectedTimeSlot = "09:00 AM";

            // Check if a date and time slot are selected
                // Make an AJAX request to the CitaView
            $.ajax({
                type: 'POST',
                url: '/cita/', // Replace with the actual URL for CitaView
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}',
                    user_id: userId,
                    selected_date: selectedDate,
                    selected_time_slot: selectedTimeSlot,
                    servicio: servicio,
                    especialista: especialista
                },
                success: function(response) {
                    // Handle the success response
                    console.log(response);
                },
                error: function(error) {
                    // Handle the error response
                    console.log(error);
                }
            });
           
        });

        $('#crearCitaInvitado').click(function() {
            // Code to execute when the button is clicked
        });


    });
</script>
{% endblock %}

{% block extrabody %}{% endblock %}
